<!-- 
UI 개선 사항:
1. 전체화면 버튼 추가
2. 종료 팝업에 트레이 모드 체크박스 추가
-->
<Window x:Class="Flax.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="Flax" Height="850" Width="1200" Background="#0A0A0A"
        WindowStyle="None" AllowsTransparency="True" ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <LinearGradientBrush x:Key="DynamicGradientBackground" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#050F0A" Offset="0.0"/>
            <GradientStop Color="#081426" Offset="0.5"/>
            <GradientStop Color="#1A0505" Offset="1.0"/>
        </LinearGradientBrush>

        <!-- 스크롤바 스타일 -->
        <Style x:Key="CustomScrollBarThumb" TargetType="Thumb">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border x:Name="ThumbBorder" Background="#333333" CornerRadius="4" Opacity="0.4"/>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ThumbBorder" Property="Background" Value="#ff6262"/>
                                <Setter TargetName="ThumbBorder" Property="Opacity" Value="0.7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ScrollBar">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Width" Value="8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid>
                            <Border Background="{TemplateBinding Background}" CornerRadius="4"/>
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource CustomScrollBarThumb}"/>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Height" Value="8"/>
                    <Setter Property="Width" Value="Auto"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 사이드바 버튼 스타일 -->
        <Style x:Key="SidebarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#888"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="60"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="15,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock x:Name="icon" Grid.Column="0" 
                                          Text="{TemplateBinding Tag}" 
                                          FontSize="20" 
                                          Foreground="{TemplateBinding Foreground}"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Center"/>
                                <TextBlock x:Name="text" Grid.Column="1" 
                                          Text="{TemplateBinding Content}" 
                                          FontSize="14" 
                                          FontWeight="Medium"
                                          Foreground="{TemplateBinding Foreground}"
                                          VerticalAlignment="Center"
                                          Margin="10,0,0,0"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1A1A1A"/>
                                <Setter TargetName="icon" Property="Foreground" Value="#ff6262"/>
                                <Setter TargetName="text" Property="Foreground" Value="#FFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ActiveSidebarButtonStyle" TargetType="Button" BasedOn="{StaticResource SidebarButtonStyle}">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="#ff6262"/>
        </Style>

        <!-- 클릭 애니메이션 스타일 -->
        <Style x:Key="ClickableCardStyle" TargetType="Border">
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <EventTrigger RoutedEvent="MouseLeftButtonDown">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX" 
                                           To="0.97" Duration="0:0:0.1"/>
                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY" 
                                           To="0.97" Duration="0:0:0.1"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
                <EventTrigger RoutedEvent="MouseLeftButtonUp">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX" 
                                           To="1" Duration="0:0:0.1"/>
                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY" 
                                           To="1" Duration="0:0:0.1"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border Background="{StaticResource DynamicGradientBackground}" CornerRadius="15" BorderBrush="#222" BorderThickness="1">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 사이드바 -->
            <Border x:Name="Sidebar" Grid.Column="0" Background="#0A0A0A" CornerRadius="15,0,0,15" 
                    Width="70" MouseEnter="Sidebar_MouseEnter" MouseLeave="Sidebar_MouseLeave">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!--
                    <TextBlock x:Name="SidebarLogo" Grid.Row="0" Text="F" FontSize="24" FontWeight="Bold" 
                               Foreground="#ff6262" HorizontalAlignment="Center" Margin="0,25,0,25"/>
                    -->



                    <Border Grid.Row="0" Background="Transparent" Height="70">
                        <Image x:Name="SidebarLogo" 
                           Source="/Flax-t.png" 
                           Width="50" 
                           Height="50" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center" 
                           Stretch="Uniform"/>
                    </Border>

                    <!-- 메뉴 -->
                    <StackPanel Grid.Row="1" VerticalAlignment="Top">
                        <Button x:Name="BtnHome" Content="홈" Tag="🏠" Style="{StaticResource ActiveSidebarButtonStyle}" Click="BtnHome_Click"/>
                        <Button x:Name="BtnSearch" Content="검색" Tag="🔍" Style="{StaticResource SidebarButtonStyle}" Click="BtnSearch_Click"/>
                        <Button x:Name="BtnFollow" Content="팔로우" Tag="🌟" Style="{StaticResource SidebarButtonStyle}" Click="BtnFollow_Click"/>
                        <Button x:Name="BtnSettings" Content="설정" Tag="⚙️" Style="{StaticResource SidebarButtonStyle}" Click="BtnSettings_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 메인 콘텐츠 -->
            <Grid Grid.Column="1">
                <!-- 타이틀바 -->
                <Border Height="60" VerticalAlignment="Top" Background="#0A0A0A" CornerRadius="0,15,0,0" 
                        MouseDown="Window_MouseDown" Panel.ZIndex="100">
                    <Grid Margin="25,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- 페이지 타이틀 -->
                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                            <TextBlock x:Name="PageTitle" Text="FLAX" FontSize="20" FontWeight="Bold" Foreground="#FFFF6262"/>
                            <TextBlock x:Name="PageSubtitle" Text="통합 방송 시청 플랫폼" FontSize="11" Foreground="#666" Margin="0,2,0,0"/>
                        </StackPanel>

                        <!-- 윈도우 컨트롤 -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                            <!-- 새로고침 버튼 -->
                            <Button x:Name="BtnRefresh" Content="🔄" Width="35" Height="35" Margin="0,0,8,0"
                                    Background="Transparent" Foreground="#888" BorderThickness="0"
                                    FontSize="16" Cursor="Hand" Click="BtnRefresh_Click"
                                    ToolTip="새로고침">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="8">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#1A1A1A"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <!-- 전체화면 버튼 -->
                            <Button x:Name="BtnFullscreen" Content="⛶" Width="35" Height="35" Margin="0,0,8,0"
                                    Background="Transparent" Foreground="#888" BorderThickness="0"
                                    FontSize="16" Cursor="Hand" Click="Fullscreen_Click"
                                    ToolTip="전체화면">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="8">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#1A1A1A"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <!-- 최소화 버튼 -->
                            <Button Content="─" Width="35" Height="35" Margin="0,0,8,0"
                                    Background="Transparent" Foreground="#888" BorderThickness="0"
                                    FontSize="16" Cursor="Hand" Click="Minimize_Click">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="8">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#1A1A1A"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <!-- 닫기 버튼 -->
                            <Button Content="✕" Width="35" Height="35"
                                    Background="Transparent" Foreground="#888" BorderThickness="0"
                                    FontSize="16" Cursor="Hand" Click="Close_Click">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="8">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#ff6262"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <Grid Grid.Row="2">
                    <!-- 로딩 -->
                    <Grid x:Name="LoadingLayer" Visibility="Collapsed" Panel.ZIndex="10" Background="#0A0A0A">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Canvas x:Name="LoadingCanvas" Width="200" Height="200">
                                <Ellipse x:Name="Ball1" Width="25" Height="25" Fill="#00FFA3" Opacity="0.6" RenderTransformOrigin="0.5,0.5">
                                    <Ellipse.RenderTransform>
                                        <TransformGroup>
                                            <ScaleTransform/>
                                            <TranslateTransform X="87.5" Y="40"/>
                                        </TransformGroup>
                                    </Ellipse.RenderTransform>
                                </Ellipse>
                                <Ellipse x:Name="Ball2" Width="25" Height="25" Fill="#3787FF" Opacity="0.6" RenderTransformOrigin="0.5,0.5">
                                    <Ellipse.RenderTransform>
                                        <TransformGroup>
                                            <ScaleTransform/>
                                            <TranslateTransform X="45" Y="120"/>
                                        </TransformGroup>
                                    </Ellipse.RenderTransform>
                                </Ellipse>
                                <Ellipse x:Name="Ball3" Width="25" Height="25" Fill="#FF0000" Opacity="0.6" RenderTransformOrigin="0.5,0.5">
                                    <Ellipse.RenderTransform>
                                        <TransformGroup>
                                            <ScaleTransform/>
                                            <TranslateTransform X="130" Y="120"/>
                                        </TransformGroup>
                                    </Ellipse.RenderTransform>
                                </Ellipse>
                            </Canvas>
                            <TextBlock x:Name="TxtLoadingTip" Text="데이터를 연결하고 있습니다..." 
                                       Foreground="#888" FontSize="15" TextAlignment="Center" Margin="0,40,0,0" Opacity="0.7"/>
                        </StackPanel>
                    </Grid>

                    <!-- 메인 페이지 -->
                    <ScrollViewer x:Name="MainPage" Margin="15,88,15,15" VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="MainPanel" HorizontalAlignment="Center">
                            <!-- Top 3: 270 * 4 + 여백(10*5) = 1130 (4개 카드 너비에 맞춤) -->
                            <ItemsControl x:Name="TopThreeList" MaxWidth="1130" Margin="0,0,0,40">
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Opacity" Value="0"/>
                                        <EventSetter Event="Loaded" Handler="Item_Loaded"/>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- 클릭 애니메이션 적용 -->
                                        <Border Margin="40,20,40,20" Height="140" Background="#111" CornerRadius="0,15,15,0" 
                                                BorderThickness="2" BorderBrush="{Binding RankBrush}" 
                                                Cursor="Hand" MouseLeftButtonUp="OnStreamClick"
                                                Style="{StaticResource ClickableCardStyle}" Width="NaN">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="250"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="150"/>
                                                </Grid.ColumnDefinitions>
                                                <!-- 썸네일 왼쪽은 각지게 (CornerRadius 0) -->
                                                <Border Grid.Column="0" CornerRadius="0" ClipToBounds="True" Background="#1A1A1A">
                                                    <Image Source="{Binding LoadedThumbnailImage}" 
                                                           Stretch="UniformToFill" 
                                                           StretchDirection="Both"/>
                                                </Border>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="25,0">
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                        <Border Background="{Binding RankBrush}" Padding="8,2" CornerRadius="4">
                                                            <TextBlock Text="{Binding RankDisplay}" Foreground="White" FontSize="12" FontWeight="Bold"/>
                                                        </Border>
                                                        <Border Background="{Binding PlatformColor}" Padding="6,2" CornerRadius="4" Margin="8,0,0,0">
                                                            <TextBlock Text="{Binding Platform}" Foreground="Black" FontSize="10" FontWeight="Bold"/>
                                                        </Border>
                                                    </StackPanel>
                                                    <TextBlock Text="{Binding Title}" Foreground="White" FontWeight="Bold" FontSize="16" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" MaxHeight="40"/>
                                                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                        <Ellipse Width="30" Height="30" StrokeThickness="0">
                                                            <Ellipse.Fill>
                                                                <ImageBrush ImageSource="{Binding LoadedProfileImage}" Stretch="UniformToFill"/>
                                                            </Ellipse.Fill>
                                                        </Ellipse>
                                                        <TextBlock Text="{Binding StreamerName}" Foreground="#AAA" FontSize="14" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </StackPanel>
                                                <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                    <TextBlock Text="LIVE" Foreground="#FF4444" FontWeight="Bold" FontSize="10" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="{Binding ViewerDisplay}" Foreground="#FF4444" FontSize="24" FontWeight="Black"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- 일반 리스트 (4개씩 정렬) -->
                            <ItemsControl x:Name="NormalList" Margin="0,10,0,0">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel HorizontalAlignment="Center"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Opacity" Value="0"/>
                                        <EventSetter Event="Loaded" Handler="Item_Loaded"/>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- 클릭 애니메이션 적용 -->
                                        <Border Width="270" Margin="10" Background="#151515" CornerRadius="12" 
                                                BorderBrush="#252525" BorderThickness="1" 
                                                Cursor="Hand" MouseLeftButtonUp="OnStreamClick"
                                                Style="{StaticResource ClickableCardStyle}">
                                            <StackPanel>
                                                <Grid Height="150">
                                                    <!-- 썸네일 상단 모서리 둥글게 처리 -->
                                                    <Border CornerRadius="12,12,0,0" ClipToBounds="True" Background="#1A1A1A">
                                                        <Image Source="{Binding LoadedThumbnailImage}" 
                                                               Stretch="UniformToFill" 
                                                               StretchDirection="Both"/>
                                                    </Border>
                                                    <Border Background="#CC000000" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="10" Padding="6,2" CornerRadius="4">
                                                        <TextBlock Text="{Binding Platform}" Foreground="{Binding PlatformColor}" FontSize="10" FontWeight="Bold"/>
                                                    </Border>
                                                    <Border Background="#CC000000" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="10" Padding="6,2" CornerRadius="4">
                                                        <TextBlock Text="{Binding RankDisplay}" Foreground="White" FontSize="11" FontWeight="Bold"/>
                                                    </Border>
                                                </Grid>
                                                <StackPanel Margin="15">
                                                    <TextBlock Text="{Binding Title}" Foreground="#EEE" FontWeight="Bold" FontSize="13" Height="40" TextWrapping="Wrap" TextTrimming="CharacterEllipsis"/>
                                                    <Grid Margin="0,10,0,0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Ellipse Width="24" Height="24" StrokeThickness="0">
                                                                <Ellipse.Fill>
                                                                    <ImageBrush ImageSource="{Binding LoadedProfileImage}" Stretch="UniformToFill"/>
                                                                </Ellipse.Fill>
                                                            </Ellipse>
                                                            <TextBlock Text="{Binding StreamerName}" Foreground="#AAA" FontSize="11" Margin="8,0,0,0" VerticalAlignment="Center" MaxWidth="120" TextTrimming="CharacterEllipsis"/>
                                                        </StackPanel>
                                                        <TextBlock Grid.Column="1" Text="{Binding ViewerDisplay}" Foreground="#FF4444" FontSize="13" FontWeight="Black" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- 검색 페이지 -->
                    <Grid x:Name="SearchPage" Visibility="Collapsed" Margin="15,0,15,15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0" Margin="20,90,20,20">
                            <Border Background="#151515" CornerRadius="12" BorderBrush="#333" BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <Grid Grid.Column="0">
                                        <TextBlock x:Name="TxtSearchPlaceholder" Text="스트리머 이름을 입력하세요..." 
                                                  Foreground="#555" FontSize="16" Margin="20,15" VerticalAlignment="Center" IsHitTestVisible="False"/>
                                        <TextBox x:Name="TxtSearch" Background="Transparent" Foreground="White" BorderThickness="0"
                                                FontSize="16" Padding="20,15" VerticalAlignment="Center"
                                                TextChanged="TxtSearch_TextChanged" KeyDown="TxtSearch_KeyDown"/>
                                    </Grid>

                                    <Button x:Name="BtnSearchExecute" Grid.Column="1" Content="🔍" FontSize="20" Foreground="#ff6262"
                                           Background="Transparent" BorderThickness="0" Width="60" Height="55" Cursor="Hand" Click="BtnSearchExecute_Click">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#222"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>
                            </Border>
                        </Grid>

                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <StackPanel x:Name="SearchResultsPanel">
                                <StackPanel x:Name="SearchEmptyState" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,100,0,0">
                                    <TextBlock Text="🔍" FontSize="80" HorizontalAlignment="Center" Margin="0,0,0,20" Opacity="0.3"/>
                                    <TextBlock Text="스트리머를 검색해보세요" FontSize="20" Foreground="#666" HorizontalAlignment="Center"/>
                                    <TextBlock Text="치지직과 SOOP의 채널을 한 번에 검색할 수 있습니다" FontSize="14" Foreground="#444" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                                </StackPanel>

                                <Grid x:Name="SearchResultsGrid" Visibility="Collapsed">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- SOOP -->
                                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                        <Border Background="#1A1A1A" Padding="15,10" Margin="20,0,10,15" CornerRadius="8">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="SOOP" Foreground="#3787FF" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="TxtSoopCount" Text="(0)" Foreground="#666" FontSize="14" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                        <ItemsControl x:Name="SoopResultsList">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <!-- 검색 결과에도 클릭 애니메이션 적용 -->
                                                    <Border Margin="20,5,10,10" Background="#151515" CornerRadius="12" 
                                                            BorderBrush="#252525" BorderThickness="1" 
                                                            Cursor="Hand" MouseLeftButtonUp="OnStreamerClick"
                                                            Style="{StaticResource ClickableCardStyle}">
                                                        <Grid Height="100">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="100"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <Viewbox Grid.Column="0" Width="70" Height="70" Margin="15">
                                                                <Ellipse Width="70" Height="70" StrokeThickness="0">
                                                                    <Ellipse.Fill>
                                                                        <ImageBrush ImageSource="{Binding LoadedProfileImage}" Stretch="UniformToFill"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>
                                                            </Viewbox>
                                                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0,15,0">
                                                                <TextBlock Text="{Binding StreamerName}" Foreground="White" FontSize="16" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                                                <Border Background="{Binding LiveStatusBrush}" Padding="6,3" CornerRadius="4" HorizontalAlignment="Left" Margin="0,6,0,0">
                                                                    <TextBlock Text="{Binding LiveStatusText}" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                                                </Border>
                                                                <TextBlock Text="{Binding FanDisplay}" Foreground="#888" FontSize="11" Margin="0,6,0,0"/>
                                                            </StackPanel>
                                                            <Button Grid.Column="1" Content="{Binding FollowButtonText}" 
                                                                    Background="{Binding FollowButtonBackground}" 
                                                                    Foreground="White" FontSize="11" FontWeight="Bold"
                                                                    Padding="15,6" BorderThickness="0" Cursor="Hand"
                                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                                    Click="BtnFollowStreamer_Click"
                                                                    Margin="0,0,15,0">
                                                                <Button.Style>
                                                                    <Style TargetType="Button">
                                                                        <Setter Property="Template">
                                                                            <Setter.Value>
                                                                                <ControlTemplate TargetType="Button">
                                                                                    <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                                                            CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                                    </Border>
                                                                                    <ControlTemplate.Triggers>
                                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                                            <Setter TargetName="border" Property="Opacity" Value="0.8"/>
                                                                                        </Trigger>
                                                                                    </ControlTemplate.Triggers>
                                                                                </ControlTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </Style>
                                                                </Button.Style>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>

                                    <!-- 치지직 -->
                                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                        <Border Background="#1A1A1A" Padding="15,10" Margin="10,0,20,15" CornerRadius="8">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="치지직" Foreground="#00FFA3" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock x:Name="TxtChzzkCount" Text="(0)" Foreground="#666" FontSize="14" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                        <ItemsControl x:Name="ChzzkResultsList">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <!-- 검색 결과에도 클릭 애니메이션 적용 -->
                                                    <Border Margin="10,5,20,10" Background="#151515" CornerRadius="12" 
                                                            BorderBrush="#252525" BorderThickness="1" 
                                                            Cursor="Hand" MouseLeftButtonUp="OnStreamerClick"
                                                            Style="{StaticResource ClickableCardStyle}">
                                                        <Grid Height="100">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="100"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <Viewbox Grid.Column="0" Width="70" Height="70" Margin="15">
                                                                <Ellipse Width="70" Height="70" StrokeThickness="0">
                                                                    <Ellipse.Fill>
                                                                        <ImageBrush ImageSource="{Binding LoadedProfileImage}" Stretch="UniformToFill"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>
                                                            </Viewbox>
                                                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0,15,0">
                                                                <TextBlock Text="{Binding StreamerName}" Foreground="White" FontSize="16" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                                                <Border Background="{Binding LiveStatusBrush}" Padding="6,3" CornerRadius="4" HorizontalAlignment="Left" Margin="0,6,0,0">
                                                                    <TextBlock Text="{Binding LiveStatusText}" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                                                </Border>
                                                                <TextBlock Text="{Binding FollowerDisplay}" Foreground="#888" FontSize="11" Margin="0,6,0,0"/>
                                                            </StackPanel>
                                                            <Button Grid.Column="1" Content="{Binding FollowButtonText}" 
                                                                    Background="{Binding FollowButtonBackground}" 
                                                                    Foreground="White" FontSize="11" FontWeight="Bold"
                                                                    Padding="15,6" BorderThickness="0" Cursor="Hand"
                                                                    HorizontalAlignment="Right" VerticalAlignment="Center"
                                                                    Click="BtnFollowStreamer_Click"
                                                                    Margin="0,0,15,0">
                                                                <Button.Style>
                                                                    <Style TargetType="Button">
                                                                        <Setter Property="Template">
                                                                            <Setter.Value>
                                                                                <ControlTemplate TargetType="Button">
                                                                                    <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                                                            CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                                    </Border>
                                                                                    <ControlTemplate.Triggers>
                                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                                            <Setter TargetName="border" Property="Opacity" Value="0.8"/>
                                                                                        </Trigger>
                                                                                    </ControlTemplate.Triggers>
                                                                                </ControlTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </Style>
                                                                </Button.Style>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>

                    <!-- 팔로우 -->
                    <Grid x:Name="FollowPage" Visibility="Collapsed" Margin="15,0,15,15">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <!-- 헤더 -->
                                <Grid Margin="0,70,0,20">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="⭐" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <TextBlock x:Name="FollowCountText" Text="팔로우 0명" FontSize="20" FontWeight="Bold" Foreground="#FFF" VerticalAlignment="Center"/>
                                    </StackPanel>

                                    <!-- 새로고침 버튼 -->
                                    <Button x:Name="BtnRefreshFollow" Content="🔄" 
                                            Background="#1A1A1A" Foreground="#888" 
                                            FontSize="18" FontWeight="Bold"
                                            Width="40" Height="40" BorderThickness="0" Cursor="Hand"
                                            Click="BtnRefreshFollow_Click"
                                            HorizontalAlignment="Right" VerticalAlignment="Center"
                                            ToolTip="팔로우 스트리머 상태 새로고침" Margin="0,0,0,0">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                                    CornerRadius="8" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="border" Property="Background" Value="#ff6262"/>
                                                                    <Setter Property="Foreground" Value="White"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>

                                <!-- 팔로우 목록 - 플랫폼별 좌우 분할 -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- SOOP -->
                                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                        <Border Background="#1A1A1A" Padding="15,10" Margin="0,0,10,15" CornerRadius="8">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="SOOP" Foreground="#3787FF" FontSize="16" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                        <ItemsControl x:Name="SoopFollowList">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="#0D0D0D" CornerRadius="12" Padding="15" Margin="0,0,10,15" 
                                                            MouseLeftButtonDown="OnFollowedStreamerClick" Cursor="Hand"
                                                            Style="{StaticResource ClickableCardStyle}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>

                                                            <!-- 프로필 이미지 -->
                                                            <Viewbox Width="60" Height="60" Grid.Column="0">
                                                                <Ellipse Width="60" Height="60" StrokeThickness="0">
                                                                    <Ellipse.Fill>
                                                                        <ImageBrush ImageSource="{Binding LoadedProfileImage}" Stretch="UniformToFill"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>
                                                            </Viewbox>

                                                            <!-- 스트리머 정보 -->
                                                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0,8,0">
                                                                <TextBlock Text="{Binding StreamerName}" Foreground="White" FontSize="14" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                                                <Border Background="{Binding LiveStatusBrush}" Padding="6,3" CornerRadius="4" HorizontalAlignment="Left" Margin="0,6,0,0">
                                                                    <TextBlock Text="{Binding LiveStatusText}" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                                                </Border>
                                                            </StackPanel>

                                                            <!-- 언팔로우 버튼 -->
                                                            <Button Grid.Column="2" Content="✕" 
                                                                    Background="#333" Foreground="#888" 
                                                                    FontSize="16" FontWeight="Bold"
                                                                    Width="32" Height="32" BorderThickness="0" Cursor="Hand"
                                                                    Click="BtnUnfollowStreamer_Click"
                                                                    VerticalAlignment="Center">
                                                                <Button.Style>
                                                                    <Style TargetType="Button">
                                                                        <Setter Property="Template">
                                                                            <Setter.Value>
                                                                                <ControlTemplate TargetType="Button">
                                                                                    <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                                                            CornerRadius="6" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}">
                                                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                                    </Border>
                                                                                    <ControlTemplate.Triggers>
                                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                                            <Setter TargetName="border" Property="Background" Value="#ff4444"/>
                                                                                            <Setter Property="Foreground" Value="White"/>
                                                                                        </Trigger>
                                                                                    </ControlTemplate.Triggers>
                                                                                </ControlTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </Style>
                                                                </Button.Style>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>

                                    <!-- 치지직 -->
                                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                        <Border Background="#1A1A1A" Padding="15,10" Margin="10,0,0,15" CornerRadius="8">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="치지직" Foreground="#00FFA3" FontSize="16" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                        <ItemsControl x:Name="ChzzkFollowList">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="#0D0D0D" CornerRadius="12" Padding="15" Margin="10,0,0,15" 
                                                            MouseLeftButtonDown="OnFollowedStreamerClick" Cursor="Hand"
                                                            Style="{StaticResource ClickableCardStyle}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>

                                                            <!-- 프로필 이미지 -->
                                                            <Viewbox Width="60" Height="60" Grid.Column="0">
                                                                <Ellipse Width="60" Height="60" StrokeThickness="0">
                                                                    <Ellipse.Fill>
                                                                        <ImageBrush ImageSource="{Binding LoadedProfileImage}" Stretch="UniformToFill"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>
                                                            </Viewbox>

                                                            <!-- 스트리머 정보 -->
                                                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0,8,0">
                                                                <TextBlock Text="{Binding StreamerName}" Foreground="White" FontSize="14" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                                                <Border Background="{Binding LiveStatusBrush}" Padding="6,3" CornerRadius="4" HorizontalAlignment="Left" Margin="0,6,0,0">
                                                                    <TextBlock Text="{Binding LiveStatusText}" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                                                </Border>
                                                            </StackPanel>

                                                            <!-- 언팔로우 버튼 -->
                                                            <Button Grid.Column="2" Content="✕" 
                                                                    Background="#333" Foreground="#888" 
                                                                    FontSize="16" FontWeight="Bold"
                                                                    Width="32" Height="32" BorderThickness="0" Cursor="Hand"
                                                                    Click="BtnUnfollowStreamer_Click"
                                                                    VerticalAlignment="Center">
                                                                <Button.Style>
                                                                    <Style TargetType="Button">
                                                                        <Setter Property="Template">
                                                                            <Setter.Value>
                                                                                <ControlTemplate TargetType="Button">
                                                                                    <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                                                            CornerRadius="6" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}">
                                                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                                    </Border>
                                                                                    <ControlTemplate.Triggers>
                                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                                            <Setter TargetName="border" Property="Background" Value="#ff4444"/>
                                                                                            <Setter Property="Foreground" Value="White"/>
                                                                                        </Trigger>
                                                                                    </ControlTemplate.Triggers>
                                                                                </ControlTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </Style>
                                                                </Button.Style>
                                                            </Button>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>

                                <!-- 팔로우가 없을 때 -->
                                <StackPanel x:Name="EmptyFollowMessage" Visibility="Collapsed" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,100,0,0">
                                    <TextBlock Text="⭐" FontSize="80" HorizontalAlignment="Center" Margin="0,0,0,20" Opacity="0.3"/>
                                    <TextBlock Text="팔로우한 스트리머가 없습니다" FontSize="20" FontWeight="Bold" Foreground="#888" HorizontalAlignment="Center"/>
                                    <TextBlock Text="검색에서 스트리머를 팔로우해보세요" FontSize="14" Foreground="#555" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>

                    <!-- 설정 -->
                    <Grid x:Name="SettingsPage" Visibility="Collapsed" Margin="15,0,15,15">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <!-- 헤더 -->
                                <Grid Margin="0,20,0,30">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="⚙️" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <TextBlock Text="설정" FontSize="20" FontWeight="Bold" Foreground="#FFF" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>

                                <!-- 시작프로그램 설정 -->
                                <Border Background="#0D0D0D" CornerRadius="12" Padding="25" Margin="0,0,0,15">
                                    <StackPanel>
                                        <TextBlock Text="백그라운드 실행" FontSize="16" FontWeight="Bold" Foreground="White" Margin="0,0,0,5"/>
                                        <TextBlock Text="팔로우한 스트리머의 방송 시작을 알림으로 받을 수 있습니다" FontSize="12" Foreground="#888" Margin="0,0,0,20" TextWrapping="Wrap"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="Windows 시작 시 자동 실행" FontSize="14" Foreground="White" FontWeight="Medium"/>
                                                <TextBlock Text="컴퓨터 켜질 때 Flax가 자동으로 시작됩니다 (백그라운드 모드)" FontSize="11" Foreground="#666" Margin="0,5,0,0" TextWrapping="Wrap"/>
                                            </StackPanel>

                                            <CheckBox x:Name="ChkAutoStart" Grid.Column="1" VerticalAlignment="Center" 
                                                      Checked="ChkAutoStart_Changed" Unchecked="ChkAutoStart_Changed"
                                                      Width="50" Height="26" Cursor="Hand">
                                                <CheckBox.Style>
                                                    <Style TargetType="CheckBox">
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="CheckBox">
                                                                    <Grid>
                                                                        <!-- 배경 -->
                                                                        <Border x:Name="BackBorder" Width="50" Height="26" CornerRadius="13" 
                                                                                Background="#333" BorderThickness="0"/>
                                                                        <!-- 토글 원 -->
                                                                        <Ellipse x:Name="ToggleCircle" Width="20" Height="20" Fill="White" 
                                                                                 HorizontalAlignment="Left" Margin="3,0,0,0">
                                                                            <Ellipse.RenderTransform>
                                                                                <TranslateTransform x:Name="ToggleTransform" X="0"/>
                                                                            </Ellipse.RenderTransform>
                                                                        </Ellipse>
                                                                    </Grid>
                                                                    <ControlTemplate.Triggers>
                                                                        <Trigger Property="IsChecked" Value="True">
                                                                            <Trigger.EnterActions>
                                                                                <BeginStoryboard>
                                                                                    <Storyboard>
                                                                                        <ColorAnimation Storyboard.TargetName="BackBorder" 
                                                                                                        Storyboard.TargetProperty="Background.Color"
                                                                                                        To="#ff6262" Duration="0:0:0.2"/>
                                                                                        <DoubleAnimation Storyboard.TargetName="ToggleTransform" 
                                                                                                         Storyboard.TargetProperty="X"
                                                                                                         To="24" Duration="0:0:0.2"/>
                                                                                    </Storyboard>
                                                                                </BeginStoryboard>
                                                                            </Trigger.EnterActions>
                                                                            <Trigger.ExitActions>
                                                                                <BeginStoryboard>
                                                                                    <Storyboard>
                                                                                        <ColorAnimation Storyboard.TargetName="BackBorder" 
                                                                                                        Storyboard.TargetProperty="Background.Color"
                                                                                                        To="#333333" Duration="0:0:0.2"/>
                                                                                        <DoubleAnimation Storyboard.TargetName="ToggleTransform" 
                                                                                                         Storyboard.TargetProperty="X"
                                                                                                         To="0" Duration="0:0:0.2"/>
                                                                                    </Storyboard>
                                                                                </BeginStoryboard>
                                                                            </Trigger.ExitActions>
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </CheckBox.Style>
                                            </CheckBox>
                                        </Grid>
                                    </StackPanel>
                                </Border>

                                <!-- 알림 설정 -->
                                <Border Background="#0D0D0D" CornerRadius="12" Padding="25" Margin="0,0,0,15">
                                    <StackPanel>
                                        <TextBlock Text="알림 설정" FontSize="16" FontWeight="Bold" Foreground="White" Margin="0,0,0,5"/>
                                        <TextBlock Text="라이브 알림 빈도 및 방식을 설정합니다" FontSize="12" Foreground="#888" Margin="0,0,0,20" TextWrapping="Wrap"/>

                                        <Grid Margin="0,0,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="체크 주기" FontSize="14" Foreground="White" FontWeight="Medium" VerticalAlignment="Center"/>
                                            <TextBlock x:Name="TxtCheckInterval" Grid.Column="1" Text="5분" FontSize="14" Foreground="#ff6262" FontWeight="Bold" VerticalAlignment="Center"/>
                                        </Grid>

                                        <!-- 슬라이더 추가 -->
                                        <Slider x:Name="SliderCheckInterval" 
                                                Minimum="1" Maximum="30" 
                                                Value="5" 
                                                TickFrequency="1" 
                                                IsSnapToTickEnabled="True"
                                                Margin="0,0,0,10"
                                                ValueChanged="SliderCheckInterval_ValueChanged">
                                            <Slider.Style>
                                                <Style TargetType="Slider">
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Slider">
                                                                <Grid>
                                                                    <Grid.RowDefinitions>
                                                                        <RowDefinition Height="Auto"/>
                                                                        <RowDefinition Height="Auto"/>
                                                                    </Grid.RowDefinitions>

                                                                    <!-- 트랙 -->
                                                                    <Border x:Name="TrackBackground"
                                                                            Grid.Row="0"
                                                                            Height="6"
                                                                            Background="#333333"
                                                                            CornerRadius="3"
                                                                            Margin="0,10,0,10"/>

                                                                    <!-- 진행 바 -->
                                                                    <Border x:Name="PART_SelectionRange"
                                                                            Grid.Row="0"
                                                                            Height="6"
                                                                            Background="#ff6262"
                                                                            CornerRadius="3"
                                                                            HorizontalAlignment="Left"
                                                                            Margin="0,10,0,10"/>

                                                                    <!-- Thumb -->
                                                                    <Track x:Name="PART_Track" Grid.Row="0">
                                                                        <Track.Thumb>
                                                                            <Thumb Width="20" Height="20">
                                                                                <Thumb.Style>
                                                                                    <Style TargetType="Thumb">
                                                                                        <Setter Property="Template">
                                                                                            <Setter.Value>
                                                                                                <ControlTemplate TargetType="Thumb">
                                                                                                    <Ellipse Fill="#ff6262" 
                                                                                                             Stroke="White" 
                                                                                                             StrokeThickness="2"
                                                                                                             Width="20" 
                                                                                                             Height="20"/>
                                                                                                </ControlTemplate>
                                                                                            </Setter.Value>
                                                                                        </Setter>
                                                                                    </Style>
                                                                                </Thumb.Style>
                                                                            </Thumb>
                                                                        </Track.Thumb>
                                                                    </Track>
                                                                </Grid>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </Slider.Style>
                                        </Slider>

                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="1분" FontSize="11" Foreground="#666" HorizontalAlignment="Left"/>
                                            <TextBlock Grid.Column="1" Text="30분" FontSize="11" Foreground="#666" HorizontalAlignment="Right"/>
                                        </Grid>

                                        <TextBlock x:Name="TxtCheckIntervalDescription" Text="팔로우한 스트리머의 방송 상태를 5분마다 확인합니다" FontSize="11" Foreground="#555" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>

                                <!-- 쇼케이스 모드 설정 -->
                                <Border Background="#0D0D0D" CornerRadius="12" Padding="25" Margin="0,0,0,15">
                                    <StackPanel>
                                        <TextBlock Text="쇼케이스 모드" FontSize="16" FontWeight="Bold" Foreground="White" Margin="0,0,0,5"/>
                                        <TextBlock Text="영상 녹화나 시연 시 개인정보를 보호하고 성능을 최적화합니다" FontSize="12" Foreground="#888" Margin="0,0,0,20" TextWrapping="Wrap"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="쇼케이스 모드 활성화" FontSize="14" Foreground="White" FontWeight="Medium"/>
                                                <TextBlock Text="썸네일과 프로필을 숨기고, 이름을 가명으로 대체합니다&#x0a;플랫폼, 순위, 시청자 수 등 통계 데이터는 표시됩니다" FontSize="11" Foreground="#666" Margin="0,5,0,0" TextWrapping="Wrap"/>
                                            </StackPanel>

                                            <CheckBox x:Name="ChkShowcaseMode" Grid.Column="1" VerticalAlignment="Center" 
                                                      Checked="ChkShowcaseMode_Changed" Unchecked="ChkShowcaseMode_Changed"
                                                      Width="50" Height="26" Cursor="Hand">
                                                <CheckBox.Style>
                                                    <Style TargetType="CheckBox">
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="CheckBox">
                                                                    <Grid>
                                                                        <!-- 배경 -->
                                                                        <Border x:Name="BackBorder" Width="50" Height="26" CornerRadius="13" 
                                                                                Background="#333" BorderThickness="0"/>
                                                                        <!-- 토글 원 -->
                                                                        <Ellipse x:Name="ToggleCircle" Width="20" Height="20" Fill="White" 
                                                                                 HorizontalAlignment="Left" Margin="3,0,0,0">
                                                                            <Ellipse.RenderTransform>
                                                                                <TranslateTransform x:Name="ToggleTransform" X="0"/>
                                                                            </Ellipse.RenderTransform>
                                                                        </Ellipse>
                                                                    </Grid>
                                                                    <ControlTemplate.Triggers>
                                                                        <Trigger Property="IsChecked" Value="True">
                                                                            <Trigger.EnterActions>
                                                                                <BeginStoryboard>
                                                                                    <Storyboard>
                                                                                        <ColorAnimation Storyboard.TargetName="BackBorder" 
                                                                                                        Storyboard.TargetProperty="Background.Color"
                                                                                                        To="#ff6262" Duration="0:0:0.2"/>
                                                                                        <DoubleAnimation Storyboard.TargetName="ToggleTransform" 
                                                                                                         Storyboard.TargetProperty="X"
                                                                                                         To="24" Duration="0:0:0.2"/>
                                                                                    </Storyboard>
                                                                                </BeginStoryboard>
                                                                            </Trigger.EnterActions>
                                                                            <Trigger.ExitActions>
                                                                                <BeginStoryboard>
                                                                                    <Storyboard>
                                                                                        <ColorAnimation Storyboard.TargetName="BackBorder" 
                                                                                                        Storyboard.TargetProperty="Background.Color"
                                                                                                        To="#333333" Duration="0:0:0.2"/>
                                                                                        <DoubleAnimation Storyboard.TargetName="ToggleTransform" 
                                                                                                         Storyboard.TargetProperty="X"
                                                                                                         To="0" Duration="0:0:0.2"/>
                                                                                    </Storyboard>
                                                                                </BeginStoryboard>
                                                                            </Trigger.ExitActions>
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </CheckBox.Style>
                                            </CheckBox>
                                        </Grid>
                                    </StackPanel>
                                </Border>

                                <!-- 앱 정보 -->
                                <Border Background="#0D0D0D" CornerRadius="12" Padding="25">
                                    <StackPanel>
                                        <TextBlock Text="앱 정보" FontSize="16" FontWeight="Bold" Foreground="White" Margin="0,0,0,15"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                            <TextBlock Text="버전" FontSize="13" Foreground="#888" Width="80"/>
                                            <TextBlock Text="0.0.1 Alpha Build" FontSize="13" Foreground="White" FontWeight="Medium"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="개발" FontSize="13" Foreground="#888" Width="80"/>
                                            <TextBlock Text="THESALT STUDIO - Flax Project" FontSize="13" Foreground="White" FontWeight="Medium"/>

                                        </StackPanel>
                                        <Border BorderThickness="0" HorizontalAlignment="Left" Width="150" Height="150" Margin="60,0,0,0">
                                            <Image Source="/LOGO.png" 
                                               Stretch="Uniform" 
                                               Opacity="0.8" 
                                               HorizontalAlignment="Left"/>
                                        </Border>

                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Grid>

                <wv2:WebView2 x:Name="SoopWebView" Visibility="Collapsed" Width="0" Height="0"/>
            </Grid>

            <!-- 종료 확인 팝업 (개선됨) -->
            <Grid x:Name="ExitConfirmPopup" Grid.ColumnSpan="2" Visibility="Collapsed" Panel.ZIndex="200">
                <Grid.Background>
                    <SolidColorBrush Color="#000000" Opacity="0.85"/>
                </Grid.Background>

                <Border Width="480" Height="400" Background="#0D0D0D" CornerRadius="20" BorderBrush="#333" BorderThickness="1">
                    <Border.Effect>
                        <DropShadowEffect Color="#000000" BlurRadius="40" ShadowDepth="0" Opacity="0.8"/>
                    </Border.Effect>

                    <StackPanel Margin="40" VerticalAlignment="Center">
                        <!-- 아이콘 -->
                        <TextBlock Text="👋" FontSize="52" HorizontalAlignment="Center" Margin="0,0,0,20" Foreground="#FFFFFF"/>

                        <!-- 메인 메시지 -->
                        <TextBlock Text="Flax를 종료하시겠습니까?" 
                                   FontSize="22" FontWeight="Bold" Foreground="#FFFFFF" 
                                   HorizontalAlignment="Center" TextAlignment="Center" Margin="0,0,0,10"/>

                        <!-- 서브 메시지 -->
                        <TextBlock Text="아직 볼 방송이 많이 남았는데..." 
                                   FontSize="14" Foreground="#666666" 
                                   HorizontalAlignment="Center" Margin="0,0,0,25"/>

                        <!-- 트레이 모드 체크박스 -->
                        <Border Background="#1A1A1A" CornerRadius="10" Padding="15" Margin="0,0,0,25">
                            <CheckBox x:Name="ChkMinimizeToTray" 
                                      Content="백그라운드에서 팔로우 상태 추적 계속하기" 
                                      Foreground="#CCC" FontSize="13"
                                      IsChecked="True"
                                      Checked="ChkMinimizeToTray_Changed"
                                      Unchecked="ChkMinimizeToTray_Changed">
                                <CheckBox.Style>
                                    <Style TargetType="CheckBox">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="CheckBox">
                                                    <StackPanel Orientation="Horizontal">
                                                        <Border x:Name="checkBorder" Width="20" Height="20" 
                                                                Background="#252525" BorderBrush="#444" BorderThickness="2" 
                                                                CornerRadius="4" Margin="0,0,10,0">
                                                            <TextBlock x:Name="checkMark" Text="✓" FontSize="14" 
                                                                       Foreground="#ff6262" FontWeight="Bold"
                                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                       Visibility="Collapsed"/>
                                                        </Border>
                                                        <ContentPresenter VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsChecked" Value="True">
                                                            <Setter TargetName="checkMark" Property="Visibility" Value="Visible"/>
                                                            <Setter TargetName="checkBorder" Property="BorderBrush" Value="#ff6262"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="checkBorder" Property="BorderBrush" Value="#ff6262"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </CheckBox.Style>
                            </CheckBox>
                        </Border>

                        <!-- 버튼들 -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button x:Name="BtnExitCancel" Content="계속 볼게요" Width="170" Height="50" Margin="0,0,12,0"
                                    Background="#1A1A1A" Foreground="#FFFFFF" BorderBrush="#444" BorderThickness="1"
                                    FontSize="15" FontWeight="Medium" Cursor="Hand" Click="BtnExitCancel_Click">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                                            BorderThickness="{TemplateBinding BorderThickness}" 
                                                            CornerRadius="10">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#252525"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <Button x:Name="BtnExitConfirm" Content="종료" Width="170" Height="50"
                                    Background="#ff6262" Foreground="#FFFFFF" BorderThickness="0"
                                    FontSize="15" FontWeight="Bold" Cursor="Hand" Click="BtnExitConfirm_Click">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                            CornerRadius="10">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#ff4444"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>


        </Grid>
    </Border>
</Window>
